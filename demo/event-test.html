<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haori Event System Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .event-log { background: #f5f5f5; padding: 10px; height: 200px; overflow-y: scroll; border: 1px solid #ddd; margin: 10px 0; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        button { margin: 5px; padding: 8px 12px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <h1>Haori Event System Test</h1>
    
    <div class="event-log" id="eventLog"></div>
    <button onclick="clearLog()">Clear Log</button>

    <!-- Import Event Test -->
    <div class="test-section">
        <h2>Import Events Test</h2>
        <p>Importæ©Ÿèƒ½ã¯HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®å‹•çš„èª­ã¿è¾¼ã¿ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>
        <div data-haori="importTest">
            <!-- data-importã§HTMLã‚’èª­ã¿è¾¼ã‚€ã¨ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã™ -->
        </div>
    </div>

    <!-- Bind Event Test -->
    <div class="test-section">
        <h2>Bind Events Test</h2>
        <p>ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ ã‚’å¤‰æ›´ã™ã‚‹ã¨bindchangeã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã™ã€‚</p>
        <div data-bind='{"message":"Hello World","count":0}'>
            <label>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: <input type="text" name="message"></label><br>
            <label>ã‚«ã‚¦ãƒ³ãƒˆ: <input type="number" name="count"></label>
            <div>
                <p>ç¾åœ¨ã®å€¤: {{message}} (ã‚«ã‚¦ãƒ³ãƒˆ: {{count}})</p>
            </div>
        </div>
    </div>

    <!-- Each Event Test -->
    <div class="test-section">
        <h2>Each Events Test</h2>
        <p>è¡Œã®è¿½åŠ ãƒ»å‰Šé™¤ãƒœã‚¿ãƒ³ã§eachupdateã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã™ã€‚</p>
        <div data-bind='{"items":[{"name":"Item 1","value":10},{"name":"Item 2","value":20}]}'>
            <ul data-each="items" data-each-key="name">
                <li>
                    <input type="text" name="name" value="{{name}}" style="width: 150px;">
                    <input type="number" name="value" value="{{value}}" style="width: 80px;">
                    <button data-click-row-add>â•</button>
                    <button data-click-row-remove>ğŸ—‘ï¸</button>
                </li>
            </ul>
        </div>
    </div>

    <!-- Show/Hide Event Test -->
    <div class="test-section">
        <h2>Show/Hide Events Test</h2>
        <p>ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’ON/OFFã™ã‚‹ã¨show/hideã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã™ã€‚</p>
        <form data-bind='{"visible":true}'>
            <label>
                <input type="checkbox" name="visible" value="true" checked>
                è¡¨ç¤ºã™ã‚‹
            </label>
            <div>
                <p data-if="visible">âœ… ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™</p>
                <p data-if="!visible">âŒ ã“ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯éè¡¨ç¤ºã§ã™</p>
            </div>
        </form>
    </div>

    <!-- Fetch Event Test -->
    <div class="test-section">
        <h2>Fetch Events Test</h2>
        <p>ãƒ•ã‚©ãƒ¼ãƒ ã‚’é€ä¿¡ã™ã‚‹ã¨fetchã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç«ã—ã¾ã™ï¼ˆå®Ÿéš›ã®ã‚µãƒ¼ãƒãƒ¼ãŒãªã„ãŸã‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ï¼‰ã€‚</p>
        <form data-procedure-url="/api/test" data-procedure-method="POST">
            <input type="text" name="testData" value="test" placeholder="ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿">
            <button type="submit">é€ä¿¡ï¼ˆfetchã‚¤ãƒ™ãƒ³ãƒˆãƒ†ã‚¹ãƒˆï¼‰</button>
        </form>
    </div>

    <script type="module">
        // Haoriãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã¨è‡ªå‹•çš„ã«åˆæœŸåŒ–ã•ã‚Œã¾ã™
        import '../dist/haori.es.js';

        // ãƒ­ã‚°è¡¨ç¤ºç”¨ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function logEvent(eventName, detail) {
            const log = document.getElementById('eventLog');
            const timestamp = new Date().toLocaleTimeString();
            const detailStr = detail ? JSON.stringify(detail, null, 2) : 'no detail';
            log.innerHTML += `<div><strong>[${timestamp}] ${eventName}</strong><br><pre>${detailStr}</pre></div>`;
            log.scrollTop = log.scrollHeight;
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
        document.addEventListener('haori:ready', (e) => logEvent('haori:ready', e.detail));
        document.addEventListener('haori:render', (e) => logEvent('haori:render', e.detail));
        
        document.addEventListener('haori:importstart', (e) => logEvent('haori:importstart', e.detail));
        document.addEventListener('haori:importend', (e) => logEvent('haori:importend', e.detail));
        document.addEventListener('haori:importerror', (e) => logEvent('haori:importerror', e.detail));
        
        document.addEventListener('haori:bindchange', (e) => logEvent('haori:bindchange', e.detail));
        
        document.addEventListener('haori:eachupdate', (e) => logEvent('haori:eachupdate', e.detail));
        document.addEventListener('haori:rowadd', (e) => logEvent('haori:rowadd', e.detail));
        document.addEventListener('haori:rowremove', (e) => logEvent('haori:rowremove', e.detail));
        document.addEventListener('haori:rowmove', (e) => logEvent('haori:rowmove', e.detail));
        
        document.addEventListener('haori:show', (e) => logEvent('haori:show', e.detail));
        document.addEventListener('haori:hide', (e) => logEvent('haori:hide', e.detail));
        
        document.addEventListener('haori:fetchstart', (e) => logEvent('haori:fetchstart', e.detail));
        document.addEventListener('haori:fetchend', (e) => logEvent('haori:fetchend', e.detail));
        document.addEventListener('haori:fetcherror', (e) => logEvent('haori:fetcherror', e.detail));

        // ãƒ­ã‚°ã‚¯ãƒªã‚¢é–¢æ•°
        window.clearLog = function() {
            document.getElementById('eventLog').innerHTML = '';
        };

        // åˆæœŸãƒ­ã‚°
        setTimeout(() => {
            logEvent('Page Loaded', { message: 'Event system test page loaded' });
        }, 100);
    </script>
</body>
</html>