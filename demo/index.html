<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Haori.js ãƒ‡ãƒ¢</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            border-bottom: 3px solid #4CAF50;
            padding-bottom: 10px;
        }
        h2 {
            color: #4CAF50;
            margin-top: 30px;
            border-left: 4px solid #4CAF50;
            padding-left: 10px;
        }
        .demo-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fafafa;
        }
        .output {
            background: #e8f5e9;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #4CAF50;
        }
        .dom-viewer {
            margin: 10px 0;
            border-radius: 4px;
        }
        button, input[type="submit"] {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            transition: background 0.3s;
        }
        button:hover, input[type="submit"]:hover {
            background: #45a049;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        input[type="text"], input[type="number"], select, textarea {
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 100%;
            max-width: 300px;
        }
        label {
            display: block;
            margin: 10px 0 5px 0;
            font-weight: bold;
            color: #555;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #4CAF50;
            color: white;
        }
        tr:nth-child(even) {
            background: #f9f9f9;
        }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #323232;
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        [popover].haori-toast {
            display: block;
            inset: auto 20px 20px auto;
            background: #323232;
            color: white;
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            border: none;
            margin: 0;
        }
        [popover].haori-toast-info {
            background: #2196F3;
        }
        [popover].haori-toast-warning {
            background: #FF9800;
        }
        [popover].haori-toast-error {
            background: #f44336;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
            border: 1px solid #e0e0e0;
        }
        .show-dom-btn {
            background: #2196F3;
            margin-left: 10px;
        }
        .show-dom-btn:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Haori.js ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ‡ãƒ¢</h1>
        <p>ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€Haori.jsã®æ©Ÿèƒ½ã‚’HTMLå±æ€§ã®ã¿ã§å®Ÿç¾ã—ãŸãƒ‡ãƒ¢ã§ã™ã€‚</p>

        <!-- 1. ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚° -->
        <h2>1. ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°</h2>
        <div class="demo-section" id="demo1">
            <div data-bind='{"name":"ç”°ä¸­å¤ªéƒ","age":25,"city":"æ±äº¬"}'>
                <div class="output">
                    <p><strong>åå‰:</strong> {{name}}</p>
                    <p><strong>å¹´é½¢:</strong> {{age}}æ­³</p>
                    <p><strong>éƒ½å¸‚:</strong> {{city}}</p>
                </div>
            </div>
            <button class="show-dom-btn" data-demo-id="demo1">DOMã‚’è¡¨ç¤º</button>
            <div id="dom-demo1" class="dom-viewer" style="display:none;"></div>
        </div>

        <!-- 2. æ¡ä»¶åˆ†å² -->
        <h2>2. æ¡ä»¶åˆ†å² (data-if)</h2>
        <div class="demo-section" id="demo2">
            <form>
                <label>
                    <input type="checkbox" name="showMessage" value="true">
                    ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                </label>

                <label>
                    ã‚«ã‚¦ãƒ³ãƒˆå€¤:
                    <input type="number" name="count" value="{{count}}" style="max-width: 100px;">
                </label>

                <div class="output">
                    <p data-if="showMessage">âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™</p>
                    <p data-if="!showMessage">âŒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯éè¡¨ç¤ºã§ã™</p>
                    <p data-if="count >= 5">âœ… ã‚«ã‚¦ãƒ³ãƒˆã¯5ä»¥ä¸Šã§ã™ (ç¾åœ¨: {{count}})</p>
                    <p data-if="count < 5">âŒ ã‚«ã‚¦ãƒ³ãƒˆã¯5æœªæº€ã§ã™ (ç¾åœ¨: {{count}})</p>
                </div>
            </form>
            <button class="show-dom-btn" data-demo-id="demo2">DOMã‚’è¡¨ç¤º</button>
            <div id="dom-demo2" class="dom-viewer" style="display:none;"></div>
        </div>

        <!-- 3. ãƒªã‚¹ãƒˆè¡¨ç¤º -->
        <h2>3. ãƒªã‚¹ãƒˆè¡¨ç¤º (data-each)</h2>
        <div class="demo-section" id="demo3">
            <div data-bind='{"users":[{"id":1,"name":"ç”°ä¸­å¤ªéƒ","age":25},{"id":2,"name":"ä½è—¤èŠ±å­","age":30},{"id":3,"name":"éˆ´æœ¨ä¸€éƒ","age":28}]}'>
                <div class="output">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>åå‰</th>
                                <th>å¹´é½¢</th>
                            </tr>
                        </thead>
                        <tbody data-each="users" data-each-key="id">
                            <tr>
                                <td>{{id}}</td>
                                <td>{{name}}</td>
                                <td>{{age}}æ­³</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <button class="show-dom-btn" data-demo-id="demo3">DOMã‚’è¡¨ç¤º</button>
            <div id="dom-demo3" class="dom-viewer" style="display:none;"></div>
        </div>

        <!-- 4. ãƒ•ã‚©ãƒ¼ãƒ åŒæ–¹å‘ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚° -->
        <h2>4. ãƒ•ã‚©ãƒ¼ãƒ åŒæ–¹å‘ãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°</h2>
        <div class="demo-section" id="demo4">
            <form>
                <label>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</label>
                <input type="text" name="username" placeholder="åå‰ã‚’å…¥åŠ›">

                <label>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</label>
                <input type="text" name="email" placeholder="ãƒ¡ãƒ¼ãƒ«@example.com">

                <label>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</label>
                <textarea name="message" rows="3" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›"></textarea>

                <div class="output">
                    <h3>å…¥åŠ›å†…å®¹:</h3>
                    <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼å:</strong> {{username}}</p>
                    <p><strong>ãƒ¡ãƒ¼ãƒ«:</strong> {{email}}</p>
                    <p><strong>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:</strong> {{message}}</p>
                </div>
            </form>
            <button class="show-dom-btn" data-demo-id="demo4">DOMã‚’è¡¨ç¤º</button>
            <div id="dom-demo4" class="dom-viewer" style="display:none;"></div>
        </div>

        <!-- 5. è¡Œæ“ä½œ (è¿½åŠ ãƒ»å‰Šé™¤) -->
        <h2>5. è¡Œæ“ä½œ (è¿½åŠ ãƒ»å‰Šé™¤ãƒ»ä¸¦ã³æ›¿ãˆ)</h2>
        <div class="demo-section" id="demo5">
            <form data-bind='{"items":[{"name":"é …ç›®1"},{"name":"é …ç›®2"}]}'>
                <div class="output">
                    <ul data-each="items" data-each-key="name">
                        <li>
                            {{name}}: <input type="text" name="name" style="width: 200px;">
                            <button type="button" data-click-row-prev>â†‘</button>
                            <button type="button" data-click-row-next>â†“</button>
                            <button type="button" data-click-row-add>â• è¿½åŠ </button>
                            <button type="button" data-click-row-remove style="background: #f44336;">ğŸ—‘ï¸ å‰Šé™¤</button>
                        </li>
                    </ul>
                </div>
            </form>
            <button class="show-dom-btn" data-demo-id="demo5">DOMã‚’è¡¨ç¤º</button>
            <div id="dom-demo5" class="dom-viewer" style="display:none;"></div>
        </div>

        <!-- 6. ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ (adjust) -->
        <h2>6. ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ (data-click-adjust)</h2>
        <div class="demo-section" id="demo6">
            <div data-bind='{"counter":0}'>
                <div class="output">
                    <p style="font-size: 24px;"><strong>ã‚«ã‚¦ãƒ³ãƒˆ:</strong> {{counter}}</p>
                </div>
                <input type="number" id="counter" name="counter" value="{{counter}}" readonly>
                <div>
                    <button data-click-adjust="#counter" data-click-adjust-value="1">+1</button>
                    <button data-click-adjust="#counter" data-click-adjust-value="5">+5</button>
                    <button data-click-adjust="#counter" data-click-adjust-value="-1">-1</button>
                    <button data-click-adjust="#counter" data-click-adjust-value="-5">-5</button>
                    <button data-click-reset="#counter" style="background: #ff9800;">ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
            </div>
            <button class="show-dom-btn" data-demo-id="demo6">DOMã‚’è¡¨ç¤º</button>
            <div id="dom-demo6" class="dom-viewer" style="display:none;"></div>
        </div>

        <!-- 7. ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¨ãƒˆãƒ¼ã‚¹ãƒˆ -->
        <h2>7. ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¨ãƒˆãƒ¼ã‚¹ãƒˆ</h2>
        <div class="demo-section" id="demo7">
            <div data-bind='{}'>
                <button data-click-dialog="ã“ã‚Œã¯ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™ï¼">ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤º</button>
                <button data-click-toast="ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ" style="background: #FF9800;">ãƒˆãƒ¼ã‚¹ãƒˆã‚’è¡¨ç¤º</button>
                <button
                    data-click-confirm="æœ¬å½“ã«å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿ"
                    data-click-toast="å®Ÿè¡Œã—ã¾ã—ãŸï¼"
                    style="background: #f44336;">
                    ç¢ºèªä»˜ãã‚¢ã‚¯ã‚·ãƒ§ãƒ³
                </button>
            </div>
            <button class="show-dom-btn" data-demo-id="demo7">DOMã‚’è¡¨ç¤º</button>
            <div id="dom-demo7" class="dom-viewer" style="display:none;"></div>
        </div>

        <!-- 8. è¨ˆç®—å¼ -->
        <h2>8. è¨ˆç®—å¼</h2>
        <div class="demo-section" id="demo8">
            <form>
                <label>å˜ä¾¡:</label>
                <input type="number" name="price" value="{{price}}">

                <label>æ•°é‡:</label>
                <input type="number" name="quantity" value="{{quantity}}">

                <label>æ¶ˆè²»ç¨ç‡:</label>
                <select name="taxRate">
                    <option value="0.08">8%</option>
                    <option value="0.1" selected>10%</option>
                </select>

                <div class="output">
                    <p><strong>å°è¨ˆ:</strong> {{price * quantity}}å††</p>
                    <p><strong>æ¶ˆè²»ç¨:</strong> {{Math.floor(price * quantity * taxRate)}}å††</p>
                    <p><strong>åˆè¨ˆ:</strong> {{price * quantity + Math.floor(price * quantity * taxRate)}}å††</p>
                </div>
            </form>
            <button class="show-dom-btn" data-demo-id="demo8">DOMã‚’è¡¨ç¤º</button>
            <div id="dom-demo8" class="dom-viewer" style="display:none;"></div>
        </div>

        <!-- 9. ãƒã‚¹ãƒˆã—ãŸãƒ‡ãƒ¼ã‚¿ -->
        <h2>9. ãƒã‚¹ãƒˆã—ãŸãƒ‡ãƒ¼ã‚¿</h2>
        <div class="demo-section" id="demo9">
            <div data-bind='{"user":{"name":"å±±ç”°å¤ªéƒ","profile":{"age":35,"email":"yamada@example.com","address":"æ±äº¬éƒ½æ¸‹è°·åŒº"}}}'>
                <div class="output">
                    <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</h3>
                    <p><strong>åå‰:</strong> {{user.name}}</p>
                    <p><strong>å¹´é½¢:</strong> {{user.profile.age}}æ­³</p>
                    <p><strong>ãƒ¡ãƒ¼ãƒ«:</strong> {{user.profile.email}}</p>
                    <p><strong>ä½æ‰€:</strong> {{user.profile.address}}</p>
                </div>
            </div>
            <button class="show-dom-btn" data-demo-id="demo9">DOMã‚’è¡¨ç¤º</button>
            <div id="dom-demo9" class="dom-viewer" style="display:none;"></div>
        </div>

    </div>

        <script>
                window.haori = {
                    showMessage: false,
                    count: 0,
                    username: "",
                    email: "",
                    message: "",
                    price: 0,
                    quantity: 0,
                    taxRate: 0.1
                };
                window.showMessage = window.haori.showMessage;
                window.count = window.haori.count;
                window.username = window.haori.username;
                window.email = window.haori.email;
                window.message = window.haori.message;
                window.price = window.haori.price;
                window.quantity = window.haori.quantity;
                window.taxRate = window.haori.taxRate;
        </script>
        <script type="module">
        // Haoriãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã¨è‡ªå‹•çš„ã«åˆæœŸåŒ–ã•ã‚Œã¾ã™ï¼ˆobserver.tsã«ã‚ˆã‚Šï¼‰
        import '../dist/haori.es.js';

        // DOMè¡¨ç¤ºãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        document.addEventListener('click', function(e) {
            const button = e.target.closest('.show-dom-btn');
            if (!button) return;

            const demoId = button.getAttribute('data-demo-id');
            if (!demoId) return;

            const section = document.getElementById(demoId);
            const domViewer = document.getElementById('dom-' + demoId);
            if (!section || !domViewer) return;

            if (domViewer.style.display === 'none' || domViewer.style.display === '') {
                const targetElement = section.querySelector('div[data-bind], form');
                if (!targetElement) return;

                const html = targetElement.outerHTML;
                const formatted = formatHTML(html);

                // Shadow DOMã‚’ä½¿ç”¨ã—ã¦Haoriã®MutationObserverã‹ã‚‰éš”é›¢
                if (!domViewer.shadowRoot) {
                    domViewer.attachShadow({ mode: 'open' });
                }

                // Shadow DOMå†…ã«ã‚¹ã‚¿ã‚¤ãƒ«ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¨­å®š
                domViewer.shadowRoot.innerHTML = `
                    <style>
                        :host { display: block; }
                        pre {
                            margin: 0;
                            padding: 15px;
                            background: #263238;
                            color: #aed581;
                            font-family: 'Courier New', monospace;
                            font-size: 12px;
                            border-radius: 4px;
                            overflow-x: auto;
                            white-space: pre-wrap;
                            word-wrap: break-word;
                        }
                    </style>
                    <pre>${escapeHtml(formatted)}</pre>
                `;

                domViewer.style.display = 'block';
            } else {
                domViewer.style.display = 'none';
            }
        });

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatHTML(html) {
            let formatted = '';
            let indent = 0;

            html.split(/(<[^>]+>)/g).forEach(function(node) {
                if (node.match(/^<\/\w/)) {
                    indent--;
                }

                if (node.trim()) {
                    formatted += '  '.repeat(Math.max(0, indent)) + node.trim() + '\n';
                }

                if (node.match(/^<\w[^>]*[^\/]>$/)) {
                    indent++;
                }
            });

            return formatted;
        }
    </script>
</body>
</html>
